<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚°ãƒ«ãƒ¼ãƒ—ç®¡ç† - Schedule App</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        nav {
            background: #1a1a1a;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            text-decoration: none;
        }

        .nav-buttons {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .logout-btn, .nav-link-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 0.5rem 1.5rem;
            border-radius: 20px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .logout-btn:hover, .nav-link-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
            flex: 1;
            width: 100%;
        }

        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab-btn {
            padding: 0.75rem 1.5rem;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            color: #888;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab-btn.active {
            color: #2c2c2c;
            border-bottom-color: #2c2c2c;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .welcome {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .welcome h2 { color: #333; margin-bottom: 0.5rem; }
        .user-info { color: #2c2c2c; font-weight: 600; }

        .add-group {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .add-group h3 { color: #333; margin-bottom: 1.5rem; }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 1rem;
            align-items: end;
        }

        .form-group { display: flex; flex-direction: column; }

        label {
            margin-bottom: 0.5rem;
            color: #555;
            font-weight: 500;
        }

        input, textarea, select {
            padding: 0.875rem;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s;
            font-family: inherit;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #2c2c2c;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .btn {
            padding: 0.875rem 2rem;
            background: #2c2c2c;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn:hover { background: #3a3a3a; transform: translateY(-2px); }

        .group-list, .group-tasks {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .group-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .group-header h3 { color: #333; margin: 0; }

        .group-items { display: grid; gap: 1rem; }

        .group-item {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 1rem;
            align-items: center;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 10px;
            transition: transform 0.2s;
            cursor: pointer;
        }

        .group-item:hover { transform: translateY(-2px); }

        .group-content {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .group-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
        }

        .group-description {
            font-size: 0.9rem;
            color: #888;
        }

        .group-meta {
            font-size: 0.85rem;
            color: #999;
            margin-top: 0.5rem;
        }

        .group-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-small {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s;
            font-size: 0.9rem;
        }

        .btn-view { background: #2196F3; color: white; }
        .btn-delete { background: #dc3545; color: white; }
        .btn-small:hover { transform: scale(1.05); }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #888;
        }

        .task-list {
            margin-top: 2rem;
        }

        .task-item {
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 1rem;
            align-items: center;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            transition: transform 0.2s;
        }

        .task-item:hover { transform: translateY(-2px); }

        .task-item.help-needed {
            border-left: 4px solid #ff6b6b;
        }

        .task-status {
            padding: 0.25rem 0.75rem;
            border-radius: 5px;
            font-size: 0.85rem;
            font-weight: 600;
            text-align: center;
            min-width: 80px;
        }

        .status-todo { background: #e9ecef; color: #495057; }
        .status-progress { background: #ffc107; color: white; }
        .status-done { background: #28a745; color: white; }

        .task-content {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .task-title {
            font-weight: 600;
            color: #333;
        }

        .task-creator {
            font-size: 0.85rem;
            color: #666;
        }

        .help-badge {
            display: inline-block;
            background: #ff6b6b;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 3px;
            font-size: 0.75rem;
            margin-left: 0.5rem;
        }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
        }

        .modal.show {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-header h3 { color: #333; margin: 0; }

        .close-btn {
            background: none;
            border: none;
            font-size: 2rem;
            color: #888;
            cursor: pointer;
            padding: 0;
            width: 40px;
            height: 40px;
            border-radius: 50%;
        }

        .close-btn:hover { background: #f0f0f0; }

        .modal-form { display: flex; flex-direction: column; gap: 1.5rem; }
        .modal-actions { display: flex; gap: 1rem; margin-top: 1rem; }
        .modal-actions button { flex: 1; }
        .btn-cancel { background: #6c757d; }

        @media (max-width: 768px) {
            .form-row { grid-template-columns: 1fr; }
            .group-item { grid-template-columns: 1fr; }
            .task-item { grid-template-columns: 1fr; }
            .nav-buttons { flex-direction: column; }
            .tabs { gap: 0.5rem; }
            .tab-btn { padding: 0.5rem 1rem; font-size: 0.9rem; }
        }
    </style>
</head>
<body>

<nav>
    <div class="nav-left">
        <a href="/groups.html" class="logo">Schedule App</a>
    </div>
    <div class="nav-buttons">
        <button class="nav-link-btn" onclick="window.location.href='/schedule.html'">ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</button>
        <button class="logout-btn" onclick="logout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
    </div>
</nav>

<div class="container">
    <div class="welcome">
        <h2>ã‚°ãƒ«ãƒ¼ãƒ—ç®¡ç† - <span class="user-info" id="currentUser">ã‚²ã‚¹ãƒˆ</span>ã•ã‚“</h2>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('groups-tab')">ã‚°ãƒ«ãƒ¼ãƒ—ä¸€è¦§</button>
        <button class="tab-btn" onclick="switchTab('create-group-tab')">ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆ</button>
    </div>

    <!-- ã‚°ãƒ«ãƒ¼ãƒ—ä¸€è¦§ã‚¿ãƒ– -->
    <div id="groups-tab" class="tab-content active">
        <div class="group-list">
            <div class="group-header">
                <h3>ã‚ãªãŸã®ã‚°ãƒ«ãƒ¼ãƒ—</h3>
            </div>
            <div class="group-items" id="groupList"></div>
        </div>
    </div>

    <!-- ã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆã‚¿ãƒ– -->
    <div id="create-group-tab" class="tab-content">
        <div class="add-group">
            <h3>æ–°ã—ã„ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆ</h3>
            <div class="modal-form">
                <div class="form-group">
                    <label for="groupName">ã‚°ãƒ«ãƒ¼ãƒ—å *</label>
                    <input type="text" id="groupName" placeholder="ä¾‹ï¼šãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆA">
                </div>
                <div class="form-group">
                    <label for="groupDescription">èª¬æ˜</label>
                    <textarea id="groupDescription" placeholder="ã‚°ãƒ«ãƒ¼ãƒ—ã®èª¬æ˜ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."></textarea>
                </div>
                <button class="btn" onclick="createGroup()">ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆ</button>
            </div>
        </div>
    </div>
</div>

<!-- ã‚°ãƒ«ãƒ¼ãƒ—è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="groupDetailModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <div>
                <h3 id="modalGroupName">ã‚°ãƒ«ãƒ¼ãƒ—å</h3>
                <p id="modalGroupDesc" style="color: #888; font-size: 0.9rem; margin-top: 0.5rem;"></p>
            </div>
            <button class="close-btn" onclick="closeGroupModal()">&times;</button>
        </div>

        <!-- ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§ -->
        <div style="margin-bottom: 2rem;">
            <h4 style="margin-bottom: 1rem;">ã‚°ãƒ«ãƒ¼ãƒ—ãƒ¡ãƒ³ãƒãƒ¼</h4>
            <div id="membersList" style="display: grid; gap: 0.5rem;"></div>
            <div style="margin-top: 1rem;">
                <input type="text" id="newMemberUsername" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›" style="width: 70%;">
                <button class="btn" style="width: 28%; padding: 0.875rem;" onclick="addMemberToGroup()">è¿½åŠ </button>
            </div>
        </div>

        <!-- ã‚¿ã‚¹ã‚¯ä¸€è¦§ -->
        <div style="margin-bottom: 2rem;">
            <h4 style="margin-bottom: 1rem;">ã‚¿ã‚¹ã‚¯ä¸€è¦§</h4>
            <div id="tasksList" style="display: grid; gap: 0.5rem;"></div>
        </div>

        <!-- ã‚¿ã‚¹ã‚¯ä½œæˆ -->
        <div style="background: #f9f9f9; padding: 1.5rem; border-radius: 10px; margin-bottom: 1rem;">
            <h4 style="margin-bottom: 1rem;">æ–°ã—ã„ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ </h4>
            <div class="form-group" style="margin-bottom: 0.75rem;">
                <label for="newTaskTitle">ã‚¿ã‚¹ã‚¯å</label>
                <input type="text" id="newTaskTitle" placeholder="ã‚¿ã‚¹ã‚¯å">
            </div>
            <div class="form-group" style="margin-bottom: 0.75rem;">
                <label for="newTaskDescription">èª¬æ˜</label>
                <textarea id="newTaskDescription" placeholder="ã‚¿ã‚¹ã‚¯ã®èª¬æ˜" style="min-height: 60px;"></textarea>
            </div>
            <button class="btn" onclick="addTaskToGroup()">ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ </button>
        </div>

        <div style="text-align: center; margin-top: 1.5rem;">
            <button class="btn btn-cancel" onclick="closeGroupModal()">é–‰ã˜ã‚‹</button>
        </div>
    </div>
</div>

<script>
let currentUser = null;
let currentGroupId = null;

window.onload = async function() {
    await checkLogin();
    if (currentUser) {
        loadGroups();
    }
};

function switchTab(tabName) {
    // ã™ã¹ã¦ã®ã‚¿ãƒ–ã‚’éè¡¨ç¤º
    const tabs = document.querySelectorAll('.tab-content');
    tabs.forEach(tab => tab.classList.remove('active'));
    
    // ã™ã¹ã¦ã®ãƒœã‚¿ãƒ³ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–
    const buttons = document.querySelectorAll('.tab-btn');
    buttons.forEach(btn => btn.classList.remove('active'));
    
    // é¸æŠã•ã‚ŒãŸã‚¿ãƒ–ã‚’è¡¨ç¤º
    document.getElementById(tabName).classList.add('active');
    
    // å¯¾å¿œã™ã‚‹ãƒœã‚¿ãƒ³ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã™ã‚‹
    const tabMap = {
        'groups-tab': 0,
        'create-group-tab': 1
    };
    if (tabMap[tabName] !== undefined) {
        buttons[tabMap[tabName]].classList.add('active');
    }
}

async function checkLogin() {
    try {
        const res = await fetch('/api/current-user');
        const data = await res.json();
        
        if (data.loggedIn) {
            currentUser = data.username;
            document.getElementById('currentUser').textContent = currentUser;
        } else {
            window.location.href = '/auth.html';
        }
    } catch (error) {
        console.error('Error checking login:', error);
        window.location.href = '/auth.html';
    }
}

async function logout() {
    try {
        await fetch('/api/logout', { method: 'POST' });
        window.location.href = '/auth.html';
    } catch (error) {
        console.error('Logout error:', error);
        alert('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ');
    }
}

async function createGroup() {
    const name = document.getElementById('groupName').value;
    const description = document.getElementById('groupDescription').value;

    if (!name.trim()) {
        alert('ã‚°ãƒ«ãƒ¼ãƒ—åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
    }

    try {
        const res = await fetch('/api/groups', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({name, description})
        });

        console.log('Response status:', res.status);
        console.log('Response headers:', res.headers);

        if (!res.ok) {
            const text = await res.text();
            console.error('Error response text:', text);
            alert(`ã‚¨ãƒ©ãƒ¼: ${res.status} ${res.statusText}`);
            return;
        }

        const data = await res.json();
        console.log('Response data:', data);
        
        if (data.success) {
            document.getElementById('groupName').value = '';
            document.getElementById('groupDescription').value = '';
            switchTab('groups-tab');
            loadGroups();
        } else {
            alert(data.message || 'ã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    } catch (error) {
        console.error('Error creating group:', error);
        console.error('Error stack:', error.stack);
        alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
    }
}

async function loadGroups() {
    try {
        const res = await fetch('/api/groups');
        const groups = await res.json();

        const listContainer = document.getElementById('groupList');
        
        if (groups.length === 0) {
            listContainer.innerHTML = '<div class="empty-state"><p>ã‚°ãƒ«ãƒ¼ãƒ—ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚ä½œæˆã—ã¦ãã ã•ã„ï¼</p></div>';
            return;
        }

        listContainer.innerHTML = groups.map(group => `
            <div class="group-item" onclick="openGroupModal(${group.id})">
                <div class="group-content">
                    <div class="group-name">${escapeHtml(group.name)}</div>
                    <div class="group-description">${escapeHtml(group.description || 'èª¬æ˜ãªã—')}</div>
                    <div class="group-meta">ãƒ¡ãƒ³ãƒãƒ¼æ•°: ${group.memberCount || 0}</div>
                </div>
                <div class="group-actions">
                    <button class="btn-small btn-view" onclick="event.stopPropagation(); openGroupModal(${group.id})">é–‹ã</button>
                    <button class="btn-small btn-delete" onclick="event.stopPropagation(); deleteGroup(${group.id})">å‰Šé™¤</button>
                </div>
            </div>
        `).join('');
    } catch (error) {
        console.error('Error loading groups:', error);
        alert('ã‚°ãƒ«ãƒ¼ãƒ—ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
    }
}

async function openGroupModal(groupId) {
    currentGroupId = groupId;
    
    try {
        // ã‚°ãƒ«ãƒ¼ãƒ—æƒ…å ±ã‚’å–å¾—
        const groupRes = await fetch(`/api/groups/${groupId}`);
        const group = groupRes.json ? await groupRes.json() : null;
        
        // ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§ã‚’å–å¾—
        const membersRes = await fetch(`/api/groups/${groupId}/members`);
        const members = await membersRes.json();
        
        // ã‚¿ã‚¹ã‚¯ä¸€è¦§ã‚’å–å¾—
        const tasksRes = await fetch(`/api/tasks/group/${groupId}`);
        const tasks = await tasksRes.json();
        
        // ãƒ¢ãƒ¼ãƒ€ãƒ«ã®å†…å®¹ã‚’æ›´æ–°
        document.getElementById('modalGroupName').textContent = group?.name || 'ã‚°ãƒ«ãƒ¼ãƒ—';
        document.getElementById('modalGroupDesc').textContent = group?.description || '';
        
        // ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§ã‚’è¡¨ç¤º
        const membersList = document.getElementById('membersList');
        membersList.innerHTML = members.map(m => `
            <div style="padding: 0.5rem; background: #f0f0f0; border-radius: 5px;">
                ${escapeHtml(m.username)}
            </div>
        `).join('');
        
        // ã‚¿ã‚¹ã‚¯ä¸€è¦§ã‚’è¡¨ç¤º
        const tasksList = document.getElementById('tasksList');
        if (tasks.length === 0) {
            tasksList.innerHTML = '<p style="color: #888;">ã‚¿ã‚¹ã‚¯ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“</p>';
        } else {
            tasksList.innerHTML = tasks.map(t => `
                <div class="task-item ${t.isHelpNeeded ? 'help-needed' : ''}" onclick="goToTaskDetail(${t.id})">
                    <div class="task-status status-${t.status?.toLowerCase() || 'todo'}">${getStatusLabel(t.status)}</div>
                    <div class="task-content">
                        <div class="task-title">
                            ${escapeHtml(t.title)}
                            ${t.isHelpNeeded ? '<span class="help-badge">ğŸ†˜ ãƒ˜ãƒ«ãƒ—æ±‚ã‚ã‚‹</span>' : ''}
                        </div>
                        <div class="task-creator">ä½œæˆè€…: ${escapeHtml(t.creatorUsername || 'ä¸æ˜')}</div>
                    </div>
                </div>
            `).join('');
        }
        
        // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
        document.getElementById('groupDetailModal').classList.add('show');
    } catch (error) {
        console.error('Error opening group:', error);
        alert('ã‚°ãƒ«ãƒ¼ãƒ—æƒ…å ±ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
    }
}

function closeGroupModal() {
    document.getElementById('groupDetailModal').classList.remove('show');
    document.getElementById('newTaskTitle').value = '';
    document.getElementById('newTaskDescription').value = '';
    document.getElementById('newMemberUsername').value = '';
    currentGroupId = null;
}

async function addTaskToGroup() {
    if (!currentGroupId) return;
    
    const title = document.getElementById('newTaskTitle').value;
    const description = document.getElementById('newTaskDescription').value;

    if (!title.trim()) {
        alert('ã‚¿ã‚¹ã‚¯åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
    }

    try {
        const res = await fetch('/api/tasks', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({title, description, groupId: currentGroupId})
        });

        const data = await res.json();
        
        if (data.success) {
            document.getElementById('newTaskTitle').value = '';
            document.getElementById('newTaskDescription').value = '';
            openGroupModal(currentGroupId);
        } else {
            alert(data.message || 'ã‚¿ã‚¹ã‚¯ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    } catch (error) {
        console.error('Error creating task:', error);
        alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
    }
}

async function addMemberToGroup() {
    if (!currentGroupId) return;
    
    const username = document.getElementById('newMemberUsername').value;
    if (!username.trim()) {
        alert('ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
    }

    try {
        const res = await fetch(`/api/groups/${currentGroupId}/members`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({username})
        });

        const data = await res.json();
        
        if (data.success) {
            document.getElementById('newMemberUsername').value = '';
            openGroupModal(currentGroupId);
        } else {
            alert(data.message || 'ãƒ¡ãƒ³ãƒãƒ¼è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    } catch (error) {
        console.error('Error adding member:', error);
        alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
    }
}

async function deleteGroup(groupId) {
    if (!confirm('ã“ã®ã‚°ãƒ«ãƒ¼ãƒ—ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã‚°ãƒ«ãƒ¼ãƒ—å†…ã®ã‚¿ã‚¹ã‚¯ã‚‚å‰Šé™¤ã•ã‚Œã¾ã™ã€‚')) {
        return;
    }

    try {
        const res = await fetch(`/api/groups/${groupId}`, {method: 'DELETE'});
        const data = await res.json();
        
        if (data.success) {
            closeGroupModal();
            loadGroups();
        } else {
            alert(data.message || 'å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    } catch (error) {
        console.error('Error deleting group:', error);
        alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
    }
}

function goToTaskDetail(taskId) {
    window.location.href = `/task-detail.html?taskId=${taskId}`;
}

function getStatusLabel(status) {
    const labels = {
        'TODO': 'æœªç€æ‰‹',
        'IN_PROGRESS': 'é€²è¡Œä¸­',
        'DONE': 'å®Œäº†'
    };
    return labels[status] || status || 'æœªç€æ‰‹';
}

function escapeHtml(text) {
    if (!text) return '';
    const map = {'&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;'};
    return text.replace(/[&<>"']/g, m => map[m]);
}

window.onclick = function(event) {
    const modal = document.getElementById('groupDetailModal');
    if (event.target === modal) {
        closeGroupModal();
    }
}
</script>

</body>
</html>
